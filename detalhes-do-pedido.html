<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Detalhes do Pedido - Magic Travel">
<title>Detalhes do Pedido - Magic Travel</title>
<style>
    /* Fonte padrão */
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap');
    
    body {
    font-family: 'Montserrat', sans-serif;
    margin: 0;
    background-color: #f4f4f9;
    color: #333;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    }
    
    /* Sidebar */
    #sidebar-container {
    width: 260px;
    position: fixed;
    top: 0;
    left: 0;
    height: 100%;
    background-color: #0d112d;
    color: #fff;
    overflow-y: auto;
    box-shadow: 3px 0 6px rgba(0, 0, 0, 0.2);
    transition: background-color 0.3s;
    }
    
    #sidebar-container:hover {
    background-color: #101740;
    }
    
    .sidebar-loading {
    padding: 20px;
    text-align: center;
    font-size: 14px;
    color: #ccc;
    }
    
    /* Conteúdo principal */
    .order-details {
    margin-left: 260px;
    padding: 40px;
    width: calc(100% - 260px);
    background-color: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease-in-out;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    }
    
    .order-details h1 {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 25px;
    color: #0d112d;
    text-align: center;
    animation: fadeIn 1s ease-in-out;
    }
    
    .order-details h3 {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 20px;
    color: #4a4a4a;
    animation: fadeIn 1.2s ease-in-out;
    }
    
    .order-details p {
    font-size: 18px;
    margin-bottom: 20px;
    color: #666;
    text-align: center;
    animation: fadeIn 1.4s ease-in-out;
    }
    
    .back-button {
    display: inline-block;
    margin-bottom: 30px;
    padding: 12px 24px;
    font-size: 16px;
    font-weight: 500;
    color: #fff;
    background-color: #3b7ddd;
    border-radius: 8px;
    text-decoration: none;
    transition: background-color 0.3s, transform 0.3s;
    align-self: center;
    animation: fadeIn 1.6s ease-in-out;
    }
    
    .back-button:hover {
    background-color: #565e64;
    transform: scale(1.05);
    }
    
    /* Tabelas */
    table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 30px;
    border-radius: 12px;
    overflow: hidden;
    animation: fadeIn 1.8s ease-in-out;
    }
    
    table thead {
    background-color: #f9f9fa;
    }
    
    table th, table td {
    padding: 16px 18px;
    text-align: left;
    border-bottom: 1px solid #ebebf0;
    text-transform: capitalize;
    }
    
    table th {
    font-weight: 600;
    color: #ffffff;
    background-color: #3b7ddd;
    }
    
    table td {
    color: #333;
    }
    
    table tr:nth-child(even) {
    background-color: #f7f7fb;
    }

    .section {
    margin-bottom: 40px;
    }
    
    /* Responsividade */
    @media (max-width: 768px) {
    #sidebar-container {
        width: 220px;
    }
    
    .order-details {
        margin-left: 220px;
        width: calc(100% - 220px);
    }
    }
    
    @media (max-width: 576px) {
    #sidebar-container {
        width: 100%;
        position: fixed;
        z-index: 1000;
    }
    
    .order-details {
        margin-left: 0;
        width: 100%;
    }
    }

    /* Botão adicionar linha */
    .add-row-button {
    background-color: #1cbb8c;
    color: white;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.3s;
    animation: fadeIn 2s ease-in-out;
    align-self: center;
    }

    .add-row-button:hover {
    background-color: #17a37a;
    transform: scale(1.05);
    }

    /* Animações */
    @keyframes fadeIn {
    0% {
        opacity: 0;
        transform: translateY(20px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
    }

    /* Estilização específica para a planilha do pedido */
    .planilha-pedido {
    display: flex;
    flex-direction: column;
    margin-bottom: 40px;
    }

    .planilha-pedido h3 {
    align-self: center;
    margin-bottom: 20px;
    }

    /* Ajustes para a tabela ficar como na "Foto 1" */
    planilha-tabela {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        table-layout: fixed;
    }

    .planilha-tabela thead th {
        text-align: center;
        background-color: #4a90e2;
        color: #fff;
        font-size: 14px;
        font-weight: 600;
        border: 1px solid #d9d9d9;
        padding: 10px;
    }

    .planilha-tabela thead th:nth-child(1) { width: 16%; }
    .planilha-tabela thead th:nth-child(2) { width: 8%; }
    .planilha-tabela thead th:nth-child(3) { width: 8%; }
    .planilha-tabela thead th:nth-child(4) { width: 8%; }
    .planilha-tabela thead th:nth-child(5) { width: 8%; }
    .planilha-tabela thead th:nth-child(6) { width: 8%; }
    .planilha-tabela thead th:nth-child(7) { width: 8%; }
    .planilha-tabela thead th:nth-child(8) { width: 8%; }
    .planilha-tabela thead th:nth-child(9) { width: 10%; }
    .planilha-tabela thead th:nth-child(10) { width: 8%; }
    .planilha-tabela thead th:nth-child(11) { width: 10%; }

    .planilha-tabela td {
        color: #333;
        background-color: #f9f9f9;
        text-align: center;
        padding: 8px;
        border: 1px solid #d9d9d9;
    }

    .planilha-tabela input, .planilha-tabela select {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    /* Borda arredondada no topo */
    .planilha-tabela thead th:first-child {
    border-top-left-radius: 12px;
    }

    .planilha-tabela thead th:last-child {
    border-top-right-radius: 12px;
    }

    /* Borda arredondada no rodapé */
    .planilha-tabela tbody tr:last-child td:first-child {
    border-bottom-left-radius: 12px;
    }

    .planilha-tabela tbody tr:last-child td:last-child {
    border-bottom-right-radius: 12px;
    }

    /* Estilo base para o dropdown */
    .dropdown-status {
    padding: 10px 16px;
    font-size: 14px;
    font-weight: 600;
    border: 1px solid #ccc;
    border-radius: 6px;
    cursor: pointer;
    text-align: center;
    color: #fff;
    transition: background-color 0.3s ease;
    }

    .status-primary { background-color: #007bff; } /* Azul */
    .status-info { background-color: #17a2b8; } /* Azul claro */
    .status-warning { background-color: #ffc107; color: #212529; } /* Amarelo */
    .status-danger { background-color: #dc3545; } /* Vermelho */
    .status-secondary { background-color: #6c757d; } /* Cinza */
    .status-success { background-color: #28a745; } /* Verde */

</style>
</head>
<body>
<!-- Sidebar -->
<div id="sidebar-container">
    <div class="sidebar-loading">Carregando...</div>
</div>

<!-- Conteúdo principal -->
<div class="order-details">
    <a href="pages-orders.html" class="back-button">Voltar para Página de Pedidos</a>

    <h1>Detalhes do Pedido</h1>
    <p>ID do Pedido: <span id="pedido-id">Carregando...</span></p>

    <!-- Informações do Pedido -->
    <div class="section">
    <h3>Informações do Pedido</h3>
    <table>
        <thead>
        <tr>
            <th>Status</th>          
            <th>Destino</th>
            <th>Item/Categoria</th>
            <th>Data Venda</th>
        </tr>
        </thead>
        <tbody id="order-info">
            <tr>
              <td>
                <select class="dropdown-status">
                    <option value="Pagamento recebido">Pagamento recebido</option>
                    <option value="Envio de contrato">Envio de contrato</option>
                    <option value="Aguardando Emissão">Aguardando Emissão</option>
                    <option value="Pendente de Pagamento">Pendente de Pagamento</option>
                    <option value="Envio de Brindes">Envio de Brindes</option>
                    <option value="Concluído">Concluído</option>
                  </select>
              </td>
            </tr>
          </tbody>
    </table>
    </div>

    <!-- Informações do Cliente -->
    <div class="section">
    <h3>Informações do Cliente</h3>
    <table>
        <thead>
        <tr>
            <th>Nome</th>
            <th>Email</th>
            <th>Telefone</th>
            <th>CPF</th>
            <th>Data de Nascimento</th>
            <th>Estado</th>
        </tr>
        </thead>
        <tbody id="customer-info"></tbody>
    </table>
    </div>

    <!-- Informações Financeiras -->
    <div class="section">
    <h3>Informações Financeiras</h3>
    <table>
        <thead>
        <tr>
            <th>Gateway</th>
            <th>Data Pgto</th>
            <th>Recebido</th>
            <th>Valor Repassado</th>
            <th>Data Repasse</th>
            <th>Cambio do Dia</th>
        </tr>
        </thead>
        <tbody id="financial-info"></tbody>
    </table>
    <table>
        <thead>
        <tr>
            <th>Valor Comissão</th>
            <th>Meio Pgto</th>
            <th>Bandeira Cartão</th>
            <th>Parcelas</th>
            <th>Valor Venda</th>
            <th>Custo</th>
            <th>Fornecedor</th>
        </tr>
        </thead>
        <tbody id="financial-info-2"></tbody>
    </table>
    </div>

    <!-- Informações Comerciais -->
    <div class="section">
    <h3>Informações Comerciais</h3>
    <table>
        <thead>
        <tr>
            <th>Origem do Cliente</th>
            <th>Cliente de (30%)</th>
            <th>Efetivado por (70%)</th>
            <th>Comissão Agente</th>
        </tr>
        </thead>
        <tbody id="commercial-info"></tbody>
    </table>
    </div>

    <!-- Informações Adicionais -->
    <div class="section">
    <h3>Informações Adicionais</h3>
    <table>
        <thead>
        <tr>
            <th>Observações Operacionais</th>
            <th>Observações Financeiras</th>
        </tr>
        </thead>
        <tbody id="additional-info"></tbody>
    </table>
    </div>

    <!-- Planilha do Pedido -->
    <div class="section planilha-pedido">
    <h3>Planilha do Pedido</h3>
    <table class="planilha-tabela">
        <thead>
            <tr>
                <th>Dólar Câmbio</th>
                <th>Dólar Magic</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="number" id="dolar-cambio" placeholder="Digite o câmbio"></td>
                <td id="dolar-magic">Calculando...</td>
            </tr>
        </tbody>
    </table>

    <!-- Segunda Linha: Planilha Completa -->
    <table class="planilha-tabela">
        <thead>
            <tr>
                <th>Produto</th>
                <th>Idade</th>
                <th>Net U$</th>
                <th>Lobista</th>
                <th>Número</th>
                <th>Total U$</th>
                <th>Net R$</th>
                <th>Margem</th>
                <th>Pix</th>
                <th>Taxa</th>
                <th>10x</th>
            </tr>
        </thead>
        <tbody id="spreadsheet-info">
            <tr>
                <td><input type="text" id="produto"></td>
                <td>
                    <select id="idade">
                        <option value="ADT">ADT</option>
                        <option value="CHD">CHD</option>
                    </select>
                </td>
                <td><input type="number" id="net-dollar"></td>
                <td><input type="number" id="lobista"></td>
                <td><input type="number" id="quantidade"></td>
                <td id="total-dollar">Calculando...</td>
                <td id="net-real">Calculando...</td>
                <td><input type="number" id="margem" step="0.01"></td>
                <td id="total-pix">Calculando...</td>
                <td><input type="number" id="taxa" step="0.01"></td>
                <td id="total-10x">Calculando...</td>
            </tr>
        </tbody>
    </table>
    <button id="add-row-button" class="add-row-button">Adicionar Linha</button>
    </div>

    <!-- Emissão -->
    <div class="section">
    <h3>Emissão</h3>
    <table>
        <thead>
        <tr>
            <th>Invoice</th>
            <th>Nome dos Passageiros</th>
            <th>Itens</th>
            <th>Identificador</th>
            <th>Data de Pagamento</th>
            <th>Status</th>
            </select>
            
        </tr>
        </thead>
        <tbody id="emission-info"></tbody>
    </table>
    </div>
</div>

<script>
    // Função para capturar o ID do pedido na URL
    function getPedidoId() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('pedido') || 'Não informado';
    }

    // Função para formatar datas
    function formatDate(date) {
    return date ? new Date(date).toLocaleDateString('pt-BR') : 'N/A';
    }

    // Função para carregar a sidebar
    async function loadSidebar() {
    try {
        const response = await fetch('sidebar.html');
        if (!response.ok) throw new Error('Erro ao carregar a sidebar.');

        const sidebarContent = await response.text();
        document.getElementById('sidebar-container').innerHTML = sidebarContent;
    } catch (error) {
        console.error('Erro ao carregar a sidebar:', error);
        document.getElementById('sidebar-container').innerHTML = '<p>Erro ao carregar a sidebar.</p>';
    }
    }

    // Função para carregar os detalhes do pedido
    async function loadOrderDetails() {
    const pedidoId = getPedidoId();
    if (pedidoId === 'Não informado') {
        alert('ID do pedido não informado!');
        return;
    }

    try {
        const apiUrl = `https://www.magictraveltur.com/api_pedidos.php?pedido=${pedidoId}`;
        console.log('Fetching data from API URL:', apiUrl);

        // Chama a API para obter os dados do pedido
        const response = await fetch(apiUrl);
        const pedidos = await response.json();
        console.log('API Response Data:', pedidos);

        if (!response.ok || !pedidos || pedidos.length === 0) {
        throw new Error(`Erro ao buscar os detalhes do pedido. Status: ${response.status}`);
        }

        // Assume-se que há apenas um pedido a ser exibido
        const pedido = pedidos[0];

        // Atualiza o ID do pedido na página
        document.getElementById('pedido-id').textContent = pedidoId;

        // Preenche as informações do pedido
        document.getElementById('order-info').innerHTML = `
        <tr>
            <td><select>
            <option value="Pagamento recebido" ${pedido.status === "Pagamento recebido" ? "selected" : ""}>Pagamento recebido</option>
            <option value="Envio de contrato" ${pedido.status === "Envio de contrato" ? "selected" : ""}>Envio de contrato</option>
            <option value="Aguardando Emissão" ${pedido.status === "Aguardando Emissão" ? "selected" : ""}>Aguardando Emissão</option>
            <option value="Pendente de Pagamento" ${pedido.status === "Pendente de Pagamento" ? "selected" : ""}>Pendente de Pagamento</option>
            <option value="Envio de Brindes" ${pedido.status === "Envio de Brindes" ? "selected" : ""}>Envio de Brindes</option>
            <option value="Concluído" ${pedido.status === "Concluído" ? "selected" : ""}>Concluído</option>
            </select></td>
            <td>${pedido.destino || 'N/A'}</td>
            <td>${pedido.item || 'N/A'}</td>
            <td>${formatDate(pedido.data_venda)}</td>
        </tr>`;

        // Preenche as informações do cliente
        document.getElementById('customer-info').innerHTML = `
        <tr>
            <td>${pedido.nome_comprador || 'N/A'}</td>
            <td>${pedido.email || 'N/A'}</td>
            <td>${pedido.telefone || 'N/A'}</td>
            <td>${pedido.cpf || 'N/A'}</td>
            <td>${formatDate(pedido.data_nascimento)}</td>
            <td>${pedido.uf || 'N/A'}</td>
        </tr>`;

        // Preenche as informações financeiras (primeira linha)
        document.getElementById('financial-info').innerHTML = `
        <tr>
            <td>${pedido.gateway || '<input type="text" placeholder="Gateway">'}</td>
            <td>${formatDate(pedido.data_pgto) || '<input type="date">'}</td>
            <td>${pedido.recebido ? `R$ ${parseFloat(pedido.recebido).toFixed(2)}` : '<input type="number" placeholder="Recebido">'}</td>
            <td>${pedido.valor_repassado ? `R$ ${parseFloat(pedido.valor_repassado).toFixed(2)}` : '<input type="number" placeholder="Valor Repassado">'}</td>
            <td>${formatDate(pedido.data_repasse) || '<input type="date">'}</td>
            <td>${pedido.cambio_dia || '<input type="number" placeholder="Cambio do Dia">'}</td>
        </tr>`;

        // Preenche as informações financeiras (segunda linha)
        document.getElementById('financial-info-2').innerHTML = `
        <tr>
            <td>${pedido.valor_comissao ? `R$ ${parseFloat(pedido.valor_comissao).toFixed(2)}` : '<input type="number" placeholder="Valor Comissão">'}</td>
            <td>${pedido.meio_pgto || '<input type="text" placeholder="Meio Pgto">'}</td>
            <td>${pedido.bandeira_cartao || '<input type="text" placeholder="Bandeira Cartão">'}</td>
            <td>${pedido.parcelas || '<input type="number" placeholder="Parcelas">'}</td>
            <td>${pedido.valor_venda ? `R$ ${parseFloat(pedido.valor_venda).toFixed(2)}` : '<input type="number" placeholder="Valor Venda">'}</td>
            <td>${pedido.custo ? `R$ ${parseFloat(pedido.custo).toFixed(2)}` : '<input type="number" placeholder="Custo">'}</td>
            <td>${pedido.fornecedor || '<input type="text" placeholder="Fornecedor">'}</td>
        </tr>`;

        // Preenche as informações comerciais
        document.getElementById('commercial-info').innerHTML = `
        <tr>
            <td>${pedido.origem_cliente || '<input type="text" placeholder="Origem do Cliente">'}</td>
            <td>${pedido.cliente_de || '<input type="text" placeholder="Cliente de (30%)">'}</td>
            <td>${pedido.efetivado_por || '<input type="text" placeholder="Efetivado por (70%)">'}</td>
            <td>${pedido.comissao_do_agente || '<input type="text" placeholder="Comissão Agente">'}</td>
        </tr>`;

        // Preenche as informações adicionais
        document.getElementById('additional-info').innerHTML = `
        <tr>
            <td>${pedido.observacoes_operacionais || '<input type="text" placeholder="Observações Operacionais">'}</td>
            <td>${pedido.observacoes_financeiras || '<input type="text" placeholder="Observações Financeiras">'}</td>
        </tr>`;

        // Preenche a planilha do pedido (primeira linha)
        document.getElementById('spreadsheet-info-1').innerHTML = `
        <tr>
            <td>${pedido.cambio_dia || '<input type="number" placeholder="Dolar Câmbio">'}</td>
            <td>${pedido.cambio_dia ? (parseFloat(pedido.cambio_dia.split(" | ")[0].replace(",", ".")) + 0.98).toFixed(2) : '<input type="text" placeholder="Dolar Magic">'}</td>
        </tr>`;

        // Função para adicionar uma nova linha na planilha do pedido (segunda linha)
        function addNewRow() {
        const newRow = `
        <tr>
            <td><input type="text" placeholder="Produto"></td>
            <td>
            <select>
                <option value="Adulto">Adulto</option>
                <option value="Criança">Criança</option>
            </select>
            </td>
            <td><input type="number" placeholder="Intermediario"></td>
            <td><input type="number" placeholder="Net Dollar"></td>
            <td><input type="number" placeholder="Quantidade"></td>
            <td><input type="number" placeholder="Total Dollar"></td>
            <td><input type="number" placeholder="Net Real"></td>
            <td><input type="number" placeholder="Margem"></td>
            <td><input type="number" placeholder="Total Pix"></td>
            <td><input type="number" placeholder="Gateway"></td>
            <td><input type="number" placeholder="Total 10x"></td>
        </tr>`;
        document.getElementById('spreadsheet-info-2').insertAdjacentHTML('beforeend', newRow);
        }

        // Adiciona evento ao botão para incluir nova linha
        document.getElementById('add-row-button').addEventListener('click', addNewRow);

        // Preenche a planilha do pedido (segunda linha)
        document.getElementById('spreadsheet-info-2').innerHTML = `
        <tr>
            <td>${pedido.item || '<input type="text" placeholder="Produto">'}</td>
            <td><select>
            <option value="Adulto" ${pedido.idade === "Adulto" ? "selected" : ""}>Adulto</option>
            <option value="Criança" ${pedido.idade === "Criança" ? "selected" : ""}>Criança</option>
            </select></td>
            <td>${pedido.intermediario || '<input type="number" placeholder="Intermediario">'}</td>
            <td>${pedido.net_dollar || '<input type="number" placeholder="Net Dollar">'}</td>
            <td>${pedido.quantidade || '<input type="number" placeholder="Quantidade">'}</td>
            <td>${pedido.net_dollar && pedido.intermediario && pedido.quantidade ? (parseFloat(pedido.net_dollar) + parseFloat(pedido.intermediario)) * parseInt(pedido.quantidade) : '<input type="number" placeholder="Total Dollar">'}</td>
            <td>${pedido.total_dollar && pedido.dolar_magic ? (parseFloat(pedido.total_dollar) * (parseFloat(pedido.cambio_dia.split(" | ")[0].replace(",", ".")) + 0.98)).toFixed(2) : '<input type="number" placeholder="Net Real">'}</td>
            <td>${pedido.markup || '<input type="number" placeholder="Margem">'}</td>
            <td>${pedido.net_real && pedido.markup ? (parseFloat(pedido.net_real) / (1 - parseFloat(pedido.markup))).toFixed(2) : '<input type="number" placeholder="Total Pix">'}</td>
            <td>${pedido.gateway || '<input type="number" placeholder="Gateway">'}</td>
            <td>${pedido.total_pix && pedido.gateway ? (parseFloat(pedido.total_pix) / (1 - parseFloat(pedido.gateway))).toFixed(2) : '<input type="number" placeholder="Total 10x">'}</td>
        </tr>`;

        // Preenche as informações de emissão
        document.getElementById('emission-info').innerHTML = `
        <tr>
            <td>${pedido.nf || '<input type="text" placeholder="Invoice">'}</td>
            <td>${pedido.nome || '<input type="text" placeholder="Nome dos Passageiros">'}</td>
            <td>${pedido.item || '<input type="text" placeholder="Itens">'}</td>
            <td>${pedido.identificador || '<input type="text" placeholder="Identificador">'}</td>
            <td>${formatDate(pedido.data_pgto) || '<input type="date">'}</td>
            <td><select>
            <option value="Aguardando Emissão" ${pedido.status === "Aguardando Emissão" ? "selected" : ""}>Aguardando Emissão</option>
            <option value="Pendente de Pagamento" ${pedido.status === "Pendente de Pagamento" ? "selected" : ""}>Pendente de Pagamento</option>
            </select></td>
        </tr>`;
    } catch (error) {
        console.error('Erro ao carregar os detalhes do pedido:', error);
        alert(`Erro ao carregar os dados do pedido: ${error.message}`);
    }
    }

    // Inicializa o carregamento da página
    document.addEventListener('DOMContentLoaded', () => {
    loadSidebar();
    loadOrderDetails();
    });
</script>
<script>
    // Função para atualizar a cor do dropdown
function updateDropdownColor() {
    // Seleciona o dropdown
    const dropdown = document.getElementById('status-dropdown');

    // Remove todas as classes previamente aplicadas
    dropdown.className = 'dropdown-status'; // Reseta para a classe base

    // Adiciona a classe com base no valor selecionado
    switch (dropdown.value) {
        case 'Pagamento recebido':
            dropdown.classList.add('status-primary'); // Azul
            break;
        case 'Envio de contrato':
            dropdown.classList.add('status-info'); // Azul claro
            break;
        case 'Aguardando Emissão':
            dropdown.classList.add('status-warning'); // Amarelo
            break;
        case 'Pendente de Pagamento':
            dropdown.classList.add('status-danger'); // Vermelho
            break;
        case 'Envio de Brindes':
            dropdown.classList.add('status-secondary'); // Cinza
            break;
        case 'Concluído':
            dropdown.classList.add('status-success'); // Verde
            break;
    }
}

// Adiciona evento de 'change' ao dropdown para atualizar a classe ao mudar o valor
document.addEventListener('DOMContentLoaded', () => {
    const dropdown = document.getElementById('status-dropdown');
    updateDropdownColor(); // Aplica a cor inicial com base no valor
    dropdown.addEventListener('change', updateDropdownColor); // Atualiza a cor ao mudar
});

  </script>
  <!DOCTYPE html>
  <html lang="pt-BR">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planilha do Pedido - Magic Travel</title>
  <style>
      @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap');
  
      body {
          font-family: 'Montserrat', sans-serif;
          margin: 0;
          background-color: #f4f4f9;
          color: #333;
          padding: 20px;
      }
  
      .planilha-tabela {
          width: 100%;
          border-collapse: collapse;
          margin-bottom: 20px;
          border-radius: 12px;
          overflow: hidden;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          table-layout: fixed;
      }
  
      .planilha-tabela thead th {
          text-align: center;
          background-color: #4a90e2;
          color: #fff;
          font-size: 14px;
          font-weight: 600;
          border: 1px solid #d9d9d9;
          padding: 10px;
      }
  
      .planilha-tabela tbody td {
          text-align: center;
          padding: 10px;
          border: 1px solid #d9d9d9;
          background-color: #f9f9f9;
      }
  
      .planilha-tabela input, .planilha-tabela select {
          width: 100%;
          padding: 8px;
          box-sizing: border-box;
          border: 1px solid #ccc;
          border-radius: 4px;
      }
  
      .planilha-tabela thead th:nth-child(1) { width: 16%; } /* Produto */
      .planilha-tabela thead th:nth-child(2) { width: 8%; } /* Idade */
      .planilha-tabela thead th:nth-child(3) { width: 8%; } /* Net U$ */
      .planilha-tabela thead th:nth-child(4) { width: 8%; } /* Lobista */
      .planilha-tabela thead th:nth-child(5) { width: 8%; } /* Número */
      .planilha-tabela thead th:nth-child(6) { width: 8%; } /* Total U$ */
      .planilha-tabela thead th:nth-child(7) { width: 8%; } /* Net R$ */
      .planilha-tabela thead th:nth-child(8) { width: 8%; } /* Margem */
      .planilha-tabela thead th:nth-child(9) { width: 10%; } /* Pix */
      .planilha-tabela thead th:nth-child(10) { width: 8%; } /* Taxa */
      .planilha-tabela thead th:nth-child(11) { width: 10%; } /* 10x */
  </style>
  </head>
  <body>
      <h3>Planilha do Pedido</h3>
  
      <!-- Primeira Linha: Dólar Câmbio e Dólar Magic -->
      <table class="planilha-tabela">
          <thead>
              <tr>
                  <th>Dólar Câmbio</th>
                  <th>Dólar Magic</th>
              </tr>
          </thead>
          <tbody>
              <tr>
                  <td><input type="number" id="dolar-cambio" placeholder="Digite o câmbio"></td>
                  <td id="dolar-magic">Calculando...</td>
              </tr>
          </tbody>
      </table>
  
      <!-- Segunda Linha: Planilha Completa -->
      <table class="planilha-tabela">
          <thead>
              <tr>
                  <th>Produto</th>
                  <th>Idade</th>
                  <th>Net U$</th>
                  <th>Lobista</th>
                  <th>Número</th>
                  <th>Total U$</th>
                  <th>Net R$</th>
                  <th>Margem</th>
                  <th>Pix</th>
                  <th>Taxa</th>
                  <th>10x</th>
              </tr>
          </thead>
          <tbody id="spreadsheet-info">
              <tr>
                  <td><input type="text" id="produto"></td>
                  <td>
                      <select id="idade">
                          <option value="ADT">ADT</option>
                          <option value="CHD">CHD</option>
                      </select>
                  </td>
                  <td><input type="number" id="net-dollar"></td>
                  <td><input type="number" id="lobista"></td>
                  <td><input type="number" id="quantidade"></td>
                  <td id="total-dollar">Calculando...</td>
                  <td id="net-real">Calculando...</td>
                  <td><input type="text" id="margem" placeholder="Digite a margem (%)"></td>
                  <td id="total-pix">Calculando...</td>
                  <td><input type="text" id="taxa" placeholder="Digite a taxa (%)"></td>
                  <td id="total-10x">Calculando...</td>
              </tr>
          </tbody>
      </table>
  
  <script>
      // Função para buscar dados da API
      async function fetchApiData(endpoint) {
          try {
              const response = await fetch(endpoint);
              const data = await response.json();
              return data;
          } catch (error) {
              console.error("Erro ao buscar dados da API:", error);
              return null;
          }
      }
  
      // Atualiza os campos com os dados da API
      async function carregarPlanilha() {
          const apiUrl = "https://www.magictraveltur.com/api_planilhas.php";
          const apiData = await fetchApiData(apiUrl);
  
          if (apiData) {
              document.getElementById("dolar-cambio").value = apiData.dolar_cambio || "";
              document.getElementById("produto").value = apiData.produto || "";
              document.getElementById("net-dollar").value = apiData.net_dollar || "";
              document.getElementById("lobista").value = apiData.lobista || "";
              document.getElementById("quantidade").value = apiData.quantidade || "";
          }
  
          calcularDolarMagic();
          calcularCampos();
      }
  
      // Calcula o Dólar Magic
      function calcularDolarMagic() {
          const dolarCambio = parseFloat(document.getElementById("dolar-cambio").value) || 0;
          const dolarMagic = dolarCambio / (1 - 0.0098);
          document.getElementById("dolar-magic").textContent = dolarMagic.toFixed(2);
          return dolarMagic;
      }
  
      // Calcula os valores na planilha
      function calcularCampos() {
        const netDollar = parseFloat(document.getElementById("net-dollar").value) || 0;
        const lobista = parseFloat(document.getElementById("lobista").value) || 0;
        const quantidade = parseFloat(document.getElementById("quantidade").value) || 0;
        const margem = parseFloat(document.getElementById("margem").value.replace("%", "").trim()) / 100 || 0;
        const taxa = parseFloat(document.getElementById("taxa").value.replace("%", "").trim()) / 100 || 0;

        const dolarMagic = calcularDolarMagic();

        const totalDollar = (netDollar + lobista) * quantidade;
        const netReal = totalDollar * dolarMagic;
        const totalPix = netReal / (1 - margem);
        const total10x = totalPix / (1 - taxa);

        document.getElementById("total-dollar").textContent = totalDollar.toFixed(2);
        document.getElementById("net-real").textContent = netReal.toFixed(2);
        document.getElementById("total-pix").textContent = totalPix.toFixed(2);
        document.getElementById("total-10x").textContent = total10x.toFixed(2);
    }
  
      // Eventos
      document.getElementById("dolar-cambio").addEventListener("input", calcularCampos);
      document.querySelectorAll("input, select").forEach(el => el.addEventListener("input", calcularCampos));
  
      // Inicialização
      document.addEventListener("DOMContentLoaded", carregarPlanilha);

      // Função para formatar campos como porcentagem
    function formatarPorcentagem(valor) {
        if (!valor) return "0%";
        const numero = parseFloat(valor.replace("%", "").trim());
        if (isNaN(numero)) return "0%";
        return numero.toFixed(2) + "%";
    }

    // Atualiza os campos com os dados da API
    async function carregarPlanilha() {
        const apiUrl = "https://www.magictraveltur.com/api_planilhas.php";
        const apiData = await fetchApiData(apiUrl);

        if (apiData) {
            document.getElementById("dolar-cambio").value = apiData.dolar_cambio || "";
            document.getElementById("produto").value = apiData.produto || "";
            document.getElementById("net-dollar").value = apiData.net_dollar || "";
            document.getElementById("lobista").value = apiData.lobista || "";
            document.getElementById("quantidade").value = apiData.quantidade || "";
            document.getElementById("margem").value = apiData.margem ? formatarPorcentagem(apiData.margem) : "";
            document.getElementById("taxa").value = apiData.gateway ? formatarPorcentagem(apiData.gateway) : "";
        }

        calcularDolarMagic();
        calcularCampos();
    }

    // Função para processar a entrada do usuário e garantir que é uma porcentagem
    function tratarEntradaPorcentagem(event) {
        const input = event.target;
        const valor = input.value.replace("%", "").trim();
        const numero = parseFloat(valor);
        if (!isNaN(numero)) {
            input.value = numero.toFixed(2) + "%";
        } else {
            input.value = "0%";
        }
    }

    // Eventos para garantir que a entrada de porcentagem seja corretamente formatada
    document.getElementById("margem").addEventListener("blur", tratarEntradaPorcentagem);
    document.getElementById("taxa").addEventListener("blur", tratarEntradaPorcentagem);

  </script>  
</body>
</html>
